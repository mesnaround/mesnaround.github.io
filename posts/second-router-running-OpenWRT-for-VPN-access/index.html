<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.6.2"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Second Router Running Openwrt For Vpn Access" /><meta name="author" content="Mark Schott" /><meta property="og:locale" content="en_US" /><meta name="description" content="Motivation I started this project as an almost complete networking beginner. I very much wanted to be running my default internet though a VPN. Problem was with other users in the house streaming entertainment (and other potentially VPN inconvenient sites like banking services), it was necessary to be able to easily switch between a VPN and the default pathway offered by my ISP." /><meta property="og:description" content="Motivation I started this project as an almost complete networking beginner. I very much wanted to be running my default internet though a VPN. Problem was with other users in the house streaming entertainment (and other potentially VPN inconvenient sites like banking services), it was necessary to be able to easily switch between a VPN and the default pathway offered by my ISP." /><link rel="canonical" href="https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/" /><meta property="og:url" content="https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/" /><meta property="og:site_name" content="Mark Schott" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-28T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Second Router Running Openwrt For Vpn Access" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Mark Schott"},"description":"Motivation I started this project as an almost complete networking beginner. I very much wanted to be running my default internet though a VPN. Problem was with other users in the house streaming entertainment (and other potentially VPN inconvenient sites like banking services), it was necessary to be able to easily switch between a VPN and the default pathway offered by my ISP.","headline":"Second Router Running Openwrt For Vpn Access","url":"https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/","@type":"BlogPosting","dateModified":"2020-12-28T00:00:00-05:00","datePublished":"2020-12-28T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/"},"@context":"https://schema.org"}</script><title>Second Router Running Openwrt For Vpn Access | Mark Schott</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/favicons/crab.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Mark Schott</a></div><div class="site-subtitle font-italic">Just Some Guy</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/mesnaround" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/meschott" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['m.schott9','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Second Router Running Openwrt For Vpn Access</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Second Router Running Openwrt For Vpn Access</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 28, 2020, 12:00 AM -0500" > Dec 28, 2020 <i class="unloaded">2020-12-28T00:00:00-05:00</i> </span> by <span class="author"> Mark Schott </span></div></div><div class="post-content"><h2 id="motivation">Motivation</h2><p>I started this project as an almost complete networking beginner. I very much wanted to be running my default internet though a VPN. Problem was with other users in the house streaming entertainment (and other potentially VPN inconvenient sites like banking services), it was necessary to be able to easily switch between a VPN and the default pathway offered by my ISP.</p><h2 id="approaches">Approaches</h2><p>I was able to debrick an TP-Link Archer C2600 that I had lying around a flash OpenWRT onto it. After going through the walkthrough to configure my network and setup an OpenVPN connection I noticed that the streaming video through the Rokus was not smooth. The next basic step was to fixed the ips of the roku devices and route their traffic apart from the VPN.</p><ul><li>vpn-policy-routing<ul><li>I found this package worked splendidly to assign a policy to a particular ip to avoid the VPN. The problem I ran into was that due to the VPN connection i had to disable PeerDNS through the WAN interface and assign the DNS of my VPN provider, and after routing the Netflix servers were unreachable even though they were reachable when the Roku was connected to the VPN. I don’t know the reason for this but I would be very interested into knowing why. I’m not sure if it’s because of my VPNs DNS servers when connected to the VPN or something my ISP is doing to my outbound packets. At any rate, I searched the internet for solutions on how to set a per client DNS and found some older threads that specified settings lines in dnsmasq.conf <a href="https://serverfault.com/questions/509388/per-client-dns-servers-with-dnsmasq">thread link</a>.<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>dhcp-host=B8:3E:59:15:BD:69,set:red
dhcp-option=tag:red,option:dns-server,208.122.23.22,208.122.23.23
</pre></table></code></div></div><p>It bothered me slightly that I couldn’t find anything explicit in the man page. It seems that maybe the preferred approach now is to assign per interface? For me this seemed like it would require creating a separate LAN + WAN interface depending on my configuration. I decided for a different approach.</p></ul><li>Using a second router <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/XBNr0fn.png" alt="setup" /><ul><li>One router would serve the regular network and would be through my ISP directly<li>The other would be an Access Point that would be used for any VPN connection. This is more flexible and lends itself to more complexity further down the line. Also with this I have no immediate need for policy routing.<li>I decided to use my less powerful Netgear router (not supported by OpenWRT) as my main router and connect to my OpenWRT router via Ethernet on the WAN port.<ul><li>I also changed the default DNS on the main router to point to OpenDNS servers so as not to give my ISP my DNS requests<li>DNS over HTTPS is not supported by this router but would be a nice addition<li>I disabled the 5G radio</ul><li>For the router running OpenWrt<ul><li>Make sure OpenVPN is configured<li>Change the LAN to a static address protocol and change the subnet to not conflict with the one of the main router (I just used 192.168.2.1).<li>Specify the default gateway of the main router (192.168.1.1 in my case)<li>Add custom DNS to the WAN interface<li>Disable the 2.4GHz radio</ul><li>Connect them up and leave some physical space between the routers (I just have a couple of feet) to avoid unintended interference as a precaution.</ul></ul></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Second Router Running Openwrt For Vpn Access - Mark Schott&url=https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Second Router Running Openwrt For Vpn Access - Mark Schott&u=https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Second Router Running Openwrt For Vpn Access - Mark Schott&url=https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://mesnaround.github.io/posts/second-router-running-OpenWRT-for-VPN-access/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Crypto-Musings/">Crypto Musings</a><li><a href="/posts/Interesting-Links/">Interesting Links</a></ul></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Crypto-Musings/"><div class="card-body"> <span class="timeago small" > Aug 27 <i class="unloaded">2021-08-27T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Crypto Musings</h3><div class="text-muted small"><p> An Investment? Someone close to me the other day asked for my opinion on cryptocurrency. I happily obliged as it’s one of the many topics I feel somewhat knowledgeable about but at the same time ou...</p></div></div></a></div><div class="card"> <a href="/posts/Interesting-Links/"><div class="card-body"> <span class="timeago small" > Jan 17 <i class="unloaded">2021-01-17T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Interesting Links</h3><div class="text-muted small"><p> Anti-Gerrymandering Redistricting and The Will of The People Many people are aware of the practice of Gerrymandering throughout state-level legislatures in the United States. Gerrymandering is the...</p></div></div></a></div><div class="card"> <a href="/posts/installing-graphene-OS-on-pixel3a/"><div class="card-body"> <span class="timeago small" > Dec 18, 2020 <i class="unloaded">2020-12-18T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Installing Graphene Os On Pixel3a</h3><div class="text-muted small"><p> Preface This is not intended to be a step-by-step guide. Those you should find from the supported documentation. This is just my general thoughts and high-level experience. Motivation I want to re...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/installing-graphene-OS-on-pixel3a/" class="btn btn-outline-primary"><p>Installing Graphene Os On Pixel3a</p></a> <a href="/posts/Interesting-Links/" class="btn btn-outline-primary"><p>Interesting Links</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/mesnaround">Mark Schott</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mesnaround.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
